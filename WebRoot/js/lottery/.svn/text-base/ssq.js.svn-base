var adrzhushu = [];
adrzhushu = new Array();
for(var i=0;i<34;i++){          
	adrzhushu[i]=new Array();   
    for(var j=0;j<5;j++){     
    	adrzhushu[i][j]=0; 
    }
}
adrzhushu[0][0] = 0;
adrzhushu[0][1] = 0;
adrzhushu[0][2] = 0;
adrzhushu[0][3] = 0;
adrzhushu[0][4] = 0;
adrzhushu[1][0] = 0;
adrzhushu[1][1] = 0;
adrzhushu[1][2] = 0;
adrzhushu[1][3] = 0;
adrzhushu[1][4] = 0;
adrzhushu[2][0] = 0;
adrzhushu[2][1] = 0;
adrzhushu[2][2] = 0;
adrzhushu[2][3] = 0;
adrzhushu[2][4] = 0;
adrzhushu[3][0] = 0;
adrzhushu[3][1] = 0;
adrzhushu[3][2] = 0;
adrzhushu[3][3] = 0;
adrzhushu[3][4] = 0;
adrzhushu[4][0] = 0;
adrzhushu[4][1] = 0;
adrzhushu[4][2] = 0;
adrzhushu[4][3] = 0;
adrzhushu[4][4] = 0;
adrzhushu[5][0] = 0;
adrzhushu[5][1] = 0;
adrzhushu[5][2] = 0;
adrzhushu[5][3] = 0;
adrzhushu[5][4] = 0;
adrzhushu[6][0] = 0;
adrzhushu[6][1] = 0;
adrzhushu[6][2] = 0;
adrzhushu[6][3] = 0;
adrzhushu[6][4] = 0;
adrzhushu[7][0] = 1;
adrzhushu[7][1] = 1;
adrzhushu[7][2] = 6;
adrzhushu[7][3] = 1;
adrzhushu[7][4] = 5;
adrzhushu[8][0] = 4;
adrzhushu[8][1] = 1;
adrzhushu[8][2] = 12;
adrzhushu[8][3] = 3;
adrzhushu[8][4] = 7;
adrzhushu[9][0] = 7;
adrzhushu[9][1] = 3;
adrzhushu[9][2] = 30;
adrzhushu[9][3] = 3;
adrzhushu[9][4] = 12;
adrzhushu[10][0] = 14;
adrzhushu[10][1] = 3;
adrzhushu[10][2] = 50;
adrzhushu[10][3] = 7;
adrzhushu[10][4] = 20;
adrzhushu[11][0] = 22;
adrzhushu[11][1] = 5;
adrzhushu[11][2] = 0;
adrzhushu[11][3] = 10;
adrzhushu[11][4] = 32;
adrzhushu[12][0] = 38;
adrzhushu[12][1] = 6;
adrzhushu[12][2] = 0;
adrzhushu[12][3] = 14;
adrzhushu[12][4] = 41;
adrzhushu[13][0] = 0;
adrzhushu[13][1] = 10;
adrzhushu[13][2] = 0;
adrzhushu[13][3] = 21;
adrzhushu[13][4] = 0;
adrzhushu[14][0] = 0;
adrzhushu[14][1] = 14;
adrzhushu[14][2] = 0;
adrzhushu[14][3] = 31;
adrzhushu[14][4] = 0;
adrzhushu[15][0] = 0;
adrzhushu[15][1] = 19;
adrzhushu[15][2] = 0;
adrzhushu[15][3] = 41;
adrzhushu[15][4] = 0;
adrzhushu[16][0] = 0;
adrzhushu[16][1] = 25;
adrzhushu[16][2] = 0;
adrzhushu[16][3] = 0;
adrzhushu[16][4] = 0;
adrzhushu[17][0] = 0;
adrzhushu[17][1] = 34;
adrzhushu[17][2] = 0;
adrzhushu[17][3] = 0;
adrzhushu[17][4] = 0;
adrzhushu[18][0] = 0;
adrzhushu[18][1] = 42;
adrzhushu[18][2] = 0;
adrzhushu[18][3] = 0;
adrzhushu[18][4] = 0;
adrzhushu[19][0] = 0;
adrzhushu[19][1] = 0;
adrzhushu[19][2] = 0;
adrzhushu[19][3] = 0;
adrzhushu[19][4] = 0;
adrzhushu[20][0] = 0;
adrzhushu[20][1] = 0;
adrzhushu[20][2] = 0;
adrzhushu[20][3] = 0;
adrzhushu[20][4] = 0;
adrzhushu[21][0] = 0;
adrzhushu[21][1] = 0;
adrzhushu[21][2] = 0;
adrzhushu[21][3] = 0;
adrzhushu[21][4] = 0;
adrzhushu[22][0] = 0;
adrzhushu[22][1] = 0;
adrzhushu[22][2] = 0;
adrzhushu[22][3] = 0;
adrzhushu[22][4] = 0;
adrzhushu[23][0] = 0;
adrzhushu[23][1] = 0;
adrzhushu[23][2] = 0;
adrzhushu[23][3] = 0;
adrzhushu[23][4] = 0;
adrzhushu[24][0] = 0;
adrzhushu[24][1] = 0;
adrzhushu[24][2] = 0;
adrzhushu[24][3] = 0;
adrzhushu[24][4] = 0;
adrzhushu[25][0] = 0;
adrzhushu[25][1] = 0;
adrzhushu[25][2] = 0;
adrzhushu[25][3] = 0;
adrzhushu[25][4] = 0;
adrzhushu[26][0] = 0;
adrzhushu[26][1] = 0;
adrzhushu[26][2] = 0;
adrzhushu[26][3] = 0;
adrzhushu[26][4] = 0;
adrzhushu[27][0] = 0;
adrzhushu[27][1] = 0;
adrzhushu[27][2] = 0;
adrzhushu[27][3] = 0;
adrzhushu[27][4] = 0;
adrzhushu[28][0] = 0;
adrzhushu[28][1] = 0;
adrzhushu[28][2] = 0;
adrzhushu[28][3] = 0;
adrzhushu[28][4] = 0;
adrzhushu[29][0] = 0;
adrzhushu[29][1] = 0;
adrzhushu[29][2] = 0;
adrzhushu[29][3] = 0;
adrzhushu[29][4] = 0;
adrzhushu[30][0] = 0;
adrzhushu[30][1] = 0;
adrzhushu[30][2] = 0;
adrzhushu[30][3] = 0;
adrzhushu[30][4] = 0;
adrzhushu[31][0] = 0;
adrzhushu[31][1] = 0;
adrzhushu[31][2] = 0;
adrzhushu[31][3] = 0;
adrzhushu[31][4] = 0;
adrzhushu[32][0] = 0;
adrzhushu[32][1] = 0;
adrzhushu[32][2] = 0;
adrzhushu[32][3] = 0;
adrzhushu[32][4] = 0;
adrzhushu[33][0] = 0;
adrzhushu[33][1] = 0;
adrzhushu[33][2] = 0;
adrzhushu[33][3] = 0;
adrzhushu[33][4] = 0;

var typestr = new Array("中6保5","中6保4","中5保5","中5保4","中4保4");

/*
 *常量区
 */
var RED_BALL_ON  = "ball_down_true";
var BLUE_BALL_ON = "blueball_current";

/* ssq 最大球数 */
var MAX_RED_BALL_NUMBER = 20;
var MAX_BLUE_BALL_NUMBER = 10;

/*
*全局变量
*/
var g_lotteryType = "ssq";
var g_playType = PLAY_TYPE_FS;
var g_betType = BET_TYPE_PERSONAL;

//存放所有球的对象
var g_std_all_redBallList = [];
var g_std_all_blueBallList = [];

//存放当前选中球的索引
var g_std_cur_redBallList = [];
var g_std_cur_blueBallList = [];

var bluec = [];
var g_plan;
/* 初始化函数 */
function init()
{
	initBallList();
	getTermInfo();
	onChangeBetType(0);
}

function initBallList()
{
	for(var i = 1; i < 34; i++) {
		g_std_all_redBallList[i] = $("#std_red_ball_" + i)[0];
	}
	for(var i = 1; i < 17; i++) {
		g_std_all_blueBallList[i] = $("#std_blue_ball_" + i)[0];
	}
}

/* 点击球事件 */
function onClickRedBall(ball, num)
{
	$(ball).toggleClass(RED_BALL_ON);
	if($(ball).hasClass(RED_BALL_ON)) {
		addBallToList(g_std_cur_redBallList, num);
	}
	else {
		deleteBallFromList(g_std_cur_redBallList, num);
	}
	validateBetNum(ball);
}

function onClickBlueBall(ball, num) 
{
	$(ball).toggleClass(BLUE_BALL_ON);
	if($(ball).hasClass(BLUE_BALL_ON)) {
		addBallToList(g_std_cur_blueBallList, num);
	}
	else {
		deleteBallFromList(g_std_cur_blueBallList, num);
	}
	validateBetNum(ball);
}

/* 将所选的球顺序加入列表 */
function addBallToList(list, num)
{
	var exist = false;
	for(var i = 0; i < list.length; i++) {
		if(list[i].num == num) {
			exist = true;
		}
	}
	if(!exist) {
		list[list.length] = num;
	}
}

function deleteBallFromList(list, num)
{
	for(var i = 0; i < list.length; i++) {
		if(list[i] == num) {
			list.splice(i, 1);
		}
	}
}

function clearSelectedBalls(area)
{
	
	var list = [];
	if(area == 0) { //red balls
		list = g_std_cur_redBallList;
		for(var i = 0; i < list.length; i++) {
			var index = list[i];
			$(g_std_all_redBallList[index]).removeClass(RED_BALL_ON);
		}
	}
	else if(area == 1) { //blue balls
		list = g_std_cur_blueBallList;
		for(var i = 0; i < list.length; i++) {
			var index = list[i];
			$(g_std_all_blueBallList[index]).removeClass(BLUE_BALL_ON);
		}
	}
	
	list.splice(0, list.length);
	displayBetNum();
}

function clearAllBalls()
{
	clearSelectedBalls(0);
	clearSelectedBalls(1);
}

//投注区机选
function randomSelect(list, m, n)
{
	var randomArray = random(m, n);
	for(var i = 0; i < randomArray.length; i++){
		var j = randomArray[i];
		$(list[j]).click();
	}
}

function randomSelectBalls(area)
{
	var list;
	var m;

	var n = $("#randomselect_"+area).val();
	clearSelectedBalls(area);
	
	if(area == 0) {//red balls
		m = 33;
		list = g_std_all_redBallList;
	}
	else if(area == 1) {//blue balls
		m = 16;
		list = g_std_all_blueBallList;
	}
	
	randomSelect(list, m, n);
}

//验证球的数目并显示
function validateBetNum(ball)
{
	var betCount = 0;
	switch (g_playType)
	{
	case PLAY_TYPE_FS:
		var redBallNum = g_std_cur_redBallList.length;
		var blueBallNum = g_std_cur_blueBallList.length;
		if(redBallNum > MAX_RED_BALL_NUMBER) {
			$(ball).click();
			alert("最多只能选择" + MAX_RED_BALL_NUMBER + "个红球!");
			return;
		}
		if(blueBallNum > MAX_BLUE_BALL_NUMBER) {
			$(ball).click();
			alert("最多只能选择" + MAX_BLUE_BALL_NUMBER + "个蓝球!");
			return;
		}
		betCount = math(redBallNum, 6) * math(blueBallNum, 1);
		if(betCount > 10000) {
			$(ball).click();
			alert("单倍投注不能超过10000注!");
			return;
		}
		displayBetNum();
		break;
	default:
		break;
	}
}

//显示当前用户的投注数目
function displayBetNum()
{
	var redBallNum = g_std_cur_redBallList.length;
	var blueBallNum = g_std_cur_blueBallList.length;
	var betCount = math(redBallNum, 6) * math(blueBallNum, 1);
	var obj = document.getElementById("randomselect_tcp");
	if(betCount != 0 && g_std_cur_redBallList.length > 6){
		for(var i = 0; i < obj.options.length; i ++){
			if(adrzhushu[redBallNum][i] == 0){
				obj.options[i].text = typestr[i] +":超过特定注数!";
			}else {
				obj.options[i].text = typestr[i] + ":共" + adrzhushu[redBallNum][i] * g_std_cur_blueBallList.length + "注";
			}
		}
	}else {
		for(var i = 0; i < obj.options.length; i ++){
				obj.options[i].text = typestr[i];
		}
	}
	$("#redBallNum").text(redBallNum);
	$("#blueBallNum").text(blueBallNum);
	$("#betCount").text(betCount);
	$("#betCountMoney").text(betCount * 2);
}

//分析用户选球，加入列表
function addPlan()
{
	var betCount = $("#betCount").text();
	if(betCount < 1) {
		if(g_playType != PLAY_TYPE_FILE_UPLOAD) {
			alert("请选择投注");
			return;
		}
	}
		
	switch(g_playType) {
		case PLAY_TYPE_FS:
			/*var code = g_std_cur_redBallList.join(",") + "|" 
						+ g_std_cur_blueBallList.join(",");*/
			var code = getCodeFromList(g_std_cur_redBallList) + "|" 
						+ getCodeFromList(g_std_cur_blueBallList);
			var type_code = "fs-" + code;
			var displayString = "标准投注   " + code;
			g_plan.addCode(type_code);
			addPlanToList(displayString, betCount, type_code);	
			break;
		
		case PLAY_TYPE_FILE_UPLOAD:
			parseFile();
			break;
			
		default:
			break;
	}
}


function tijiao(){
	if(g_std_cur_redBallList.length<7)
	  {alert("红球至少选择7个")
	  return;}
	if(g_std_cur_blueBallList.length<1)
	  {alert("蓝球至少选择1个")
	  return;}
	var code=getCodeFromList(g_std_cur_redBallList);
	
	var obj = document.getElementById("randomselect_tcp");

	if(confirm("您选择了" + g_std_cur_redBallList.length + "个红球：" + code + ";\n选择了" + g_std_cur_blueBallList.length + "个蓝球：" + getCodeFromList(g_std_cur_blueBallList) + ";\n选择的类型是：" + obj.options[obj.selectedIndex].text ))
	{
		var mode=$("#randomselect_tcp").val();
		if(adrzhushu[g_std_cur_redBallList.length][mode -1] == 0){
			alert("您选择的" + typestr[mode -1] +":超过特定注数，请使用软件缩水！");
			return;
		}
		code = code + "|" + mode;
		jQuery.ajax({
			url: "/lottery/suosui.htm?action=tcpsuoshui",
			type: 'post',
			data: {"code":code},
			dataType: 'json',
			success: function(data, textStatus) {
				var lanqiu = getCodeFromList(g_std_cur_blueBallList);
				bluec = getCodeFromList(g_std_cur_blueBallList).split(",");
				var str = "<p>您刚才选择了" + data.num + "个红球:" + data.haoma + ";</p><p>选择了" + bluec.length + "个蓝球:" + lanqiu + ";</p>";
				str += "<p>选用旋转矩阵公式" + data.mode1 +"，生成" + data.totalnum * bluec.length + "注，共计金额" +  data.totalnum * bluec.length * 2 + "元!</p>";
				$("#Betting_list_tcp").empty();
				$("#Betting_list_tcp").append(str);
				for(var j = 0; j < data.list1.length; j++)
				{
					var code = data.list1[j] + "|" 
					+ lanqiu;
					var type_code = "fs-" + code;
					var displayString = "标准投注   " + code;
					g_plan.addCode(type_code);
					addPlanToList(displayString, bluec.length, type_code);
				}
			},
			error: function() {
				logger.error('Ajax call failed!');
			}
		});
	}else {
		return;
	}
	
}

//机选n注
function randomBet()
{
	if(g_playType != PLAY_TYPE_FS) {
		alert("标准投注才能机选");
		return;
	}
	
	var number = $("#randomselect").val();
	
	var stringArray = [];
	var valueArray = [];
	
	for(var i = 0; i < number; ) {
		var redBallList = random(33, 6);
		var blueBallList = random(16, 1);
		var value = getCodeFromList(redBallList) + "|" + getCodeFromList(blueBallList);
		//var value = redBallList.join(",") + "|" + blueBallList.join(",");
		var code = "fs-"+value;
		var displayString = "标准投注   " + value;
		
		if($.inArray(displayString, stringArray) == -1) {
			stringArray[stringArray.length] = displayString;
			g_plan.addCode(code);
			valueArray.push(value);
			i++;
		}
	}

	for(var k in stringArray) {
		addPlanToList(stringArray[k], 1, "fs-" + valueArray[k]);
	}
}

//在小于10的数字前面加0
function getCodeFromList(redList)
{
	var code = "";
	for(var i = 0; i < redList.length; i++) {
		if(redList[i] < 10) {
			code += "0" + redList[i];
		}
		else {
			code += redList[i];
		}
		if(i < redList.length - 1) {
			code += ",";
		}
	}
	
	return code;
}

/******************** 用户确认投注 ***************************/
function onSubmit()
{
	var betTotalNum = $("#betTotalNum").text();
	
	if(g_playType != PLAY_TYPE_FILE_UPLOAD && betTotalNum <= 0) {
		alert("请选择投注号码");
		return;
	}
	
	if(g_playType == PLAY_TYPE_FILE_UPLOAD) {
		if(!checkFile()) {
			return;
		}
	}
	
	if(g_betType == BET_TYPE_PERSONAL) {
		if(g_plan.termStatus != "销售中" && g_plan.termStatus != "合买截止") {
			alert("本期已经销售截止");
			return;
		}
		var oneMoney = 2;
		if(g_playType == PLAY_TYPE_FILE_UPLOAD) {
			if( 0 == Number($("#uploadTotalBetMoney").text())) {
				alert("请填写注数！");
				$("#uploadBetNum").focus();
				return;
			}
			g_plan.setPlan(g_plan.term, g_lotteryType, Number($("#uploadTotalBetMoney").text()), 
					Number($("#uploadMultiple").val()), "0", oneMoney);
			submitPlanByFile(g_plan);
		}
		else {
			g_plan.setPlan(g_plan.term, g_lotteryType, Number($("#totalBetMoney").text()), 
					Number($("#multiple").val()), "0", oneMoney);
			submitPlan(g_plan);
		}
	}
	else if(g_betType == BET_TYPE_GROUP) {
		
		if($("#desc").val().length>100) {
			alert("对不起，方案描述不能超过100个字符");
			return;
		}
	
		if(g_plan.termStatus != "销售中") {
			alert("本期合买已经销售截止");
			return;
		}
		
		if(!validateGroupBuy()) {
			return;
		}
		
		var oneMoney = 2; //一注金额
		var description = encodeURI($("#desc").val());
		var perMoney = "1"; //合买-每份金额
		var totalPart = $("#stock").text();
		var buyPart = $("#myself").val();
		var insurePart = $("#procted").val();
		var secretType = $(":radio[name='content'][checked]").val();
		var commision = $("#commision").val(); //佣金百分比
		
		if(g_playType == PLAY_TYPE_FILE_UPLOAD) {
			if( 0 == Number($("#uploadTotalBetMoney").text())) {
				alert("请填写注数！");
				$("#uploadBetNum").focus();
				return;
			}
			g_plan.setPlan(g_plan.term, g_lotteryType, Number($("#uploadTotalBetMoney").text()), 
					Number($("#uploadMultiple").val()), "0", oneMoney, "0", "0", description, 
					perMoney, totalPart, buyPart, insurePart, commision, secretType);
			submitPlanByFile(g_plan);
		}
		else {
			g_plan.setPlan(g_plan.term, g_lotteryType, Number($("#totalBetMoney").text()), 
					Number($("#multiple").val()), "0", oneMoney, "0", "0", description, 
					perMoney, totalPart, buyPart, insurePart, commision, secretType);
			submitPlan(g_plan);
		}
		
	}
	else {
		var winStopped = $("#iswinStopped").attr("checked") ? "true" : "false";
		if(g_plan.termStatus!="销售中" && g_plan.termStatus!="合买截止"){
			alert("本期已经销售截止");
			return;
		}
		
		g_plan.setPlan(g_plan.term, g_lotteryType, Number($("#totalBetMoney").text()), 
			Number($("#multiple").val()), winStopped, oneMoney, Number($("#chaseTotalMoney").text()), 
			Number($("#chaseStopMoney").text()));
		submitPlan(g_plan);
	}
}

//显示开奖数据
function displayHistory(last, pre_list)
{
	//alert(last);
	//alert(pre_list);
	
	var history_last = "";
	var redballs = last.split("^")[1].split("|")[0].split(",");
	var blueball = last.split("^")[1].split("|")[1];
	history_last += "<ul><li>"+redballs[0]+"</li><li>"+redballs[1]+
					"</li><li>"+redballs[2]+"</li><li>"+redballs[3]+
					"</li><li>"+redballs[4]+"</li><li>"+redballs[5]+"</li>";
	history_last += "<li style=\"background:url(../images/369caibg/ball_bg.gif) -97px center no-repeat;\">"
					+blueball+"</li></ul>";
	$("#history_last").html(history_last);
	
	var history_pre = "<ul>";
	for(var i = 0; i < 4; i++) {
		var term = pre_list[i].split("^")[0];
		var redballs = pre_list[i].split("^")[1].split("|")[0];
		var blueball = pre_list[i].split("^")[1].split("|")[1];
		
		history_pre += "<li><span class=\"black\">"+ term +"</span>&nbsp;<span class=\"red\">"+redballs+
						"</span>&nbsp;|&nbsp;<span class=\"blue\">"+blueball+"</span></li>";
	}
	history_pre += "</ul>";
	$("#history_pre_list").html(history_pre);
}


